@startuml Users Management Activity
skinparam monochrome true
skinparam shadowing false
skinparam ActivityBackgroundColor white
skinparam ActivityBorderColor black
skinparam ArrowColor black
skinparam NoteBackgroundColor white
skinparam NoteBorderColor black

|Healthcare Staff|
|System|

start

partition "Users Management" {
  |System|
  :Load Users List;
  :Display Users Table;
  note right
    Table Shows:
    - S.No
    - Profile Picture
    - Display Name
    - Username
    - Action Buttons
  end note

  |Healthcare Staff|
  if (Action?) then (Add User)
    :Fill User Form;
    note right
      Required Fields:
      - Display Name
      - Username
      - Password
      - Profile Picture
    end note
    
    :Submit Form;
    
    |System|
    :Check Username Availability;
    
    if (Username Available?) then (yes)
      :Validate Form Data;
      
      if (Valid?) then (yes)
        :Begin Transaction;
        fork
          :Upload Profile Picture;
        fork again
          :Hash Password (MD5);
        end fork
        
        if (Upload Success?) then (yes)
          :Save User Data;
          if (Save Success?) then (yes)
            :Commit Transaction;
            :Show Success Toast;
            :Refresh Users List;
          else (no)
            :Rollback Transaction;
            :Show Error Toast;
          endif
        else (no)
          :Show Upload Error;
        endif
      else (no)
        :Show Validation Error;
      endif
    else (no)
      :Show Username Taken Toast;
      :Disable Save Button;
    endif
    
  else (Edit User)
    |Healthcare Staff|
    :Click Edit Button;
    note right
      Only current user
      can edit their
      own profile
    end note
    
    |System|
    if (Current User?) then (yes)
      :Navigate to Update Page;
    else (no)
      :Button Disabled;
    endif
  endif
}

stop

@enduml 